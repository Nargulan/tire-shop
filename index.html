<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>Каталог шин</title>
<style>
body { font-family: Arial, sans-serif; margin: 20px; background: #fff; }
h1 { text-align: center; margin-bottom: 15px; }
.controls { text-align: center; margin-bottom: 15px; }
input, select { margin: 0 5px 10px; padding: 8px; width: 150px; }
#products { display: flex; flex-wrap: wrap; justify-content: center; gap: 12px; }
.card { border: 1px solid #ddd; padding: 10px; width: 260px; box-shadow: 1px 1px 5px rgba(0,0,0,0.1); background: #fefefe; }
.card img { width: 100%; height: auto; object-fit: contain; }
.card h3 { margin: 5px 0; font-size: 18px; }
.card p { margin: 4px 0; font-size: 14px; }
a.buy-btn { display: block; text-align: center; margin-top: 8px; padding: 8px; background: #25d366; color: white; text-decoration: none; font-weight: bold; border-radius: 4px; }
</style>
</head>
<body>

<h1>Каталог шин</h1>

<div class="controls">
  <input id="searchSize" type="text" placeholder="Поиск по размеру">
  <select id="filterSeason">
    <option value="">Сезон</option>
    <option value="Зима">Зима</option>
    <option value="Лето">Лето</option>
    <option value="Всесезон">Всесезон</option>
  </select>
</div>

<div id="products">Загрузка...</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.2/papaparse.min.js"></script>
<script>
const sheetUrl = "https://docs.google.com/spreadsheets/d/e/2PACX-1vRMe3Xbtzrt3WmiYKEOCv5WI_i4_cuR9AX1WxJrNKIHDXya8D1nwSq-YWhXz8wyS1BYWEN1g-bS5-y5/pub?output=csv";
let allProducts = [];

// Парсим CSV через PapaParse
Papa.parse(sheetUrl, {
    download: true,
    header: true,
    skipEmptyLines: true,
    complete: function(results) {
        allProducts = results.data.filter(p => p.Наличие && p.Наличие.toLowerCase().includes("в наличии"));
        showProducts(allProducts);
    },
    error: function(err) {
        document.getElementById("products").innerHTML = "Ошибка загрузки данных.";
        console.error(err);
    }
});

function showProducts(list) {
  const container = document.getElementById("products");
  container.innerHTML = "";
  if(list.length === 0){
    container.innerHTML = "<p>Нет товаров для отображения</p>";
    return;
  }
  list.forEach(p => {
    const card = document.createElement("div");
    card.className = "card";
    card.innerHTML = `
      <img src="${p.Фото}" alt="Фото">
      <h3>${p.Бренд} ${p.Модель}</h3>
      <p><b>${p.Размер}</b></p>
      <p>Сезон: ${p.Сезон}</p>
      <p>Цена: <b>${p.Цена} ₸</b></p>
      <p>${p.Описание}</p>
      <a class="buy-btn" href="https://wa.me/WHATSAPP_NUMBER?text=Здравствуйте!%20Интересует%20шина%20${encodeURIComponent(p.Бренд + " " + p.Модель + " " + p.Размер)}" target="_blank">Купить</a>
    `;
    container.appendChild(card);
  });
}

// Поиск по размеру
document.getElementById("searchSize").addEventListener("input", e => {
  const val = e.target.value.toLowerCase();
  showProducts(allProducts.filter(p => p.Размер.toLowerCase().includes(val)));
});

// Фильтр по сезону
document.getElementById("filterSeason").addEventListener("change", e => {
  const season = e.target.value;
  showProducts(allProducts.filter(p => !season || p.Сезон === season));
});
</script>

</body>
</html>
